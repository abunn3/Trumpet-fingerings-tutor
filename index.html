<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Trumpet Note Quiz</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    const TrumpetQuiz = () => {
      // All notes with both sharps and flats as separate entries
      const allNotes = [
        { name: 'F', displayName: 'Low F', line: -3, ledger: true, accidental: '', fingering: [1, 0, 0] },
        { name: 'F#', displayName: 'Low F#', line: -3, ledger: true, accidental: '#', fingering: [1, 1, 1] },
        { name: 'Gb', displayName: 'Low Gb', line: -2.5, ledger: true, accidental: 'b', fingering: [1, 1, 1] },
        { name: 'G', displayName: 'Low G', line: -2.5, ledger: true, accidental: '', fingering: [1, 0, 1] },
        { name: 'G#', displayName: 'Low G#', line: -2.5, ledger: true, accidental: '#', fingering: [0, 1, 1] },
        { name: 'Ab', displayName: 'Low Ab', line: -2, ledger: true, accidental: 'b', fingering: [0, 1, 1] },
        { name: 'A', displayName: 'Low A', line: -2, ledger: true, accidental: '', fingering: [1, 1, 0] },
        { name: 'A#', displayName: 'Low A#', line: -2, ledger: true, accidental: '#', fingering: [1, 0, 0] },
        { name: 'Bb', displayName: 'Low Bb', line: -1.5, ledger: true, accidental: 'b', fingering: [1, 0, 0] },
        { name: 'B', displayName: 'Low B', line: -1.5, ledger: true, accidental: '', fingering: [0, 1, 0] },
        { name: 'C', displayName: 'C (1 ledger below)', line: -1, ledger: true, accidental: '', fingering: [0, 0, 0] },
        { name: 'C#', displayName: 'C# (below staff)', line: -1, ledger: true, accidental: '#', fingering: [1, 1, 1] },
        { name: 'Db', displayName: 'Db (below staff)', line: -0.5, ledger: false, accidental: 'b', fingering: [1, 1, 1] },
        { name: 'D', displayName: 'D (below staff)', line: -0.5, ledger: false, accidental: '', fingering: [1, 0, 1] },
        { name: 'D#', displayName: 'D#', line: -0.5, ledger: false, accidental: '#', fingering: [0, 1, 1] },
        { name: 'Eb', displayName: 'Eb', line: 0, ledger: false, accidental: 'b', fingering: [0, 1, 1] },
        { name: 'E', displayName: 'E (bottom line)', line: 0, ledger: false, accidental: '', fingering: [1, 1, 0] },
        { name: 'F', displayName: 'F (1st space)', line: 0.5, ledger: false, accidental: '', fingering: [1, 0, 0] },
        { name: 'F#', displayName: 'F#', line: 0.5, ledger: false, accidental: '#', fingering: [0, 1, 0] },
        { name: 'Gb', displayName: 'Gb', line: 1, ledger: false, accidental: 'b', fingering: [0, 1, 0] },
        { name: 'G', displayName: 'G (2nd line)', line: 1, ledger: false, accidental: '', fingering: [0, 0, 0] },
        { name: 'G#', displayName: 'G#', line: 1, ledger: false, accidental: '#', fingering: [0, 1, 1] },
        { name: 'Ab', displayName: 'Ab', line: 1.5, ledger: false, accidental: 'b', fingering: [0, 1, 1] },
        { name: 'A', displayName: 'A (2nd space)', line: 1.5, ledger: false, accidental: '', fingering: [1, 1, 0] },
        { name: 'A#', displayName: 'A#', line: 1.5, ledger: false, accidental: '#', fingering: [1, 0, 0] },
        { name: 'Bb', displayName: 'Bb', line: 2, ledger: false, accidental: 'b', fingering: [1, 0, 0] },
        { name: 'B', displayName: 'B (middle line)', line: 2, ledger: false, accidental: '', fingering: [0, 1, 0] },
        { name: 'C', displayName: 'C (3rd space)', line: 2.5, ledger: false, accidental: '', fingering: [0, 0, 0] },
        { name: 'C#', displayName: 'C#', line: 2.5, ledger: false, accidental: '#', fingering: [1, 1, 0] },
        { name: 'Db', displayName: 'Db', line: 3, ledger: false, accidental: 'b', fingering: [1, 1, 0] },
        { name: 'D', displayName: 'D (4th line)', line: 3, ledger: false, accidental: '', fingering: [1, 0, 0] },
        { name: 'D#', displayName: 'D#', line: 3, ledger: false, accidental: '#', fingering: [0, 1, 0] },
        { name: 'Eb', displayName: 'Eb', line: 3.5, ledger: false, accidental: 'b', fingering: [0, 1, 0] },
        { name: 'E', displayName: 'E (4th space)', line: 3.5, ledger: false, accidental: '', fingering: [0, 0, 0] },
        { name: 'F', displayName: 'F (top line)', line: 4, ledger: false, accidental: '', fingering: [1, 0, 0] },
        { name: 'F#', displayName: 'F# (upper)', line: 4, ledger: false, accidental: '#', fingering: [0, 1, 1] },
        { name: 'Gb', displayName: 'Gb (upper)', line: 4.5, ledger: false, accidental: 'b', fingering: [0, 1, 1] },
        { name: 'G', displayName: 'G (above staff)', line: 4.5, ledger: false, accidental: '', fingering: [0, 0, 0] },
        { name: 'G#', displayName: 'G# (upper)', line: 4.5, ledger: true, accidental: '#', fingering: [0, 1, 1] },
        { name: 'Ab', displayName: 'Ab (upper)', line: 5, ledger: true, accidental: 'b', fingering: [0, 1, 1] },
        { name: 'A', displayName: 'A (1 ledger above)', line: 5, ledger: true, accidental: '', fingering: [1, 1, 0] },
        { name: 'A#', displayName: 'A# (upper)', line: 5, ledger: true, accidental: '#', fingering: [1, 0, 0] },
        { name: 'Bb', displayName: 'Bb (upper)', line: 5.5, ledger: true, accidental: 'b', fingering: [1, 0, 0] },
        { name: 'B', displayName: 'B', line: 5.5, ledger: true, accidental: '', fingering: [0, 1, 0] },
        { name: 'C', displayName: 'High C', line: 6, ledger: true, accidental: '', fingering: [0, 0, 0] },
        { name: 'C#', displayName: 'High C#', line: 6, ledger: true, accidental: '#', fingering: [1, 1, 0] },
        { name: 'Db', displayName: 'High Db', line: 6.5, ledger: true, accidental: 'b', fingering: [1, 1, 0] },
        { name: 'D', displayName: 'High D', line: 6.5, ledger: true, accidental: '', fingering: [1, 0, 0] },
        { name: 'D#', displayName: 'High D#', line: 6.5, ledger: true, accidental: '#', fingering: [0, 1, 0] },
        { name: 'Eb', displayName: 'High Eb', line: 7, ledger: true, accidental: 'b', fingering: [0, 1, 0] },
        { name: 'E', displayName: 'High E', line: 7, ledger: true, accidental: '', fingering: [0, 0, 0] },
        { name: 'F', displayName: 'High F', line: 7.5, ledger: true, accidental: '', fingering: [1, 0, 0] },
      ];

      // Preset ranges
      const presets = {
        beginner: { min: 20, max: 27, name: 'Beginner' }, // G to C
        staff: { min: 16, max: 34, name: 'Staff Notes' }, // E to F
        extended: { min: 10, max: 40, name: 'Extended' }, // Low C to High A
        full: { min: 0, max: 51, name: 'Full Range' }
      };

      const [minNoteIndex, setMinNoteIndex] = useState(20); // Start with beginner range
      const [maxNoteIndex, setMaxNoteIndex] = useState(27);
      const [currentNote, setCurrentNote] = useState(null);
      const [noteName, setNoteName] = useState('');
      const [accidental, setAccidental] = useState('');
      const [valves, setValves] = useState([0, 0, 0]);
      const [score, setScore] = useState({ correct: 0, total: 0 });
      const [feedback, setFeedback] = useState(null);
      const [remainingNotes, setRemainingNotes] = useState([]);
      const [fingeringEnabled, setFingeringEnabled] = useState(true);
      const [includeAccidentals, setIncludeAccidentals] = useState(true);
      const [isDragging, setIsDragging] = useState(null);
      const sliderRef = useRef(null);

      const notes = allNotes
        .slice(minNoteIndex, maxNoteIndex + 1)
        .filter(note => includeAccidentals || note.accidental === '');

      const selectNextNote = () => {
        const currentNoteIds = notes.map(n => `${n.name}-${n.line}`);
        const poolIsValid = remainingNotes.length > 0 && 
                           remainingNotes.every(n => currentNoteIds.includes(`${n.name}-${n.line}`));
        
        let notesToPickFrom = poolIsValid ? remainingNotes : [...notes];
        const randomIndex = Math.floor(Math.random() * notesToPickFrom.length);
        const selectedNote = notesToPickFrom[randomIndex];
        const updatedRemaining = notesToPickFrom.filter((_, i) => i !== randomIndex);
        setRemainingNotes(updatedRemaining);
        setCurrentNote(selectedNote);
      };

      useEffect(() => {
        selectNextNote();
      }, []);

      useEffect(() => {
        setFeedback(null);
        setNoteName('');
        setAccidental('');
        setValves([0, 0, 0]);
        selectNextNote();
      }, [minNoteIndex, maxNoteIndex]);

      useEffect(() => {
        setFeedback(null);
        setValves([0, 0, 0]);
      }, [fingeringEnabled]);

      useEffect(() => {
        setFeedback(null);
        setNoteName('');
        setAccidental('');
        selectNextNote();
      }, [includeAccidentals]);

      const setPreset = (preset) => {
        setMinNoteIndex(preset.min);
        setMaxNoteIndex(preset.max);
      };

      const handleSliderMouseDown = (e, handle) => {
        e.preventDefault();
        setIsDragging(handle);
      };

      const handleSliderMove = (e) => {
        if (!isDragging || !sliderRef.current) return;
        
        const rect = sliderRef.current.getBoundingClientRect();
        const clientX = e.touches ? e.touches[0].clientX : e.clientX;
        const x = Math.max(0, Math.min(clientX - rect.left, rect.width));
        const percentage = x / rect.width;
        const index = Math.round(percentage * (allNotes.length - 1));
        
        if (isDragging === 'min') {
          setMinNoteIndex(Math.min(index, maxNoteIndex));
        } else {
          setMaxNoteIndex(Math.max(index, minNoteIndex));
        }
      };

      const handleSliderEnd = () => {
        setIsDragging(null);
      };

      useEffect(() => {
        if (isDragging) {
          document.addEventListener('mousemove', handleSliderMove);
          document.addEventListener('mouseup', handleSliderEnd);
          document.addEventListener('touchmove', handleSliderMove);
          document.addEventListener('touchend', handleSliderEnd);
          
          return () => {
            document.removeEventListener('mousemove', handleSliderMove);
            document.removeEventListener('mouseup', handleSliderEnd);
            document.removeEventListener('touchmove', handleSliderMove);
            document.removeEventListener('touchend', handleSliderEnd);
          };
        }
      }, [isDragging, minNoteIndex, maxNoteIndex]);

      const toggleValve = (index) => {
        const newValves = [...valves];
        newValves[index] = newValves[index] === 0 ? 1 : 0;
        setValves(newValves);
      };

      const checkAnswer = () => {
        if (!currentNote) return;
        const userAnswer = noteName + accidental;
        const nameCorrect = userAnswer === currentNote.name;
        const fingeringCorrect = fingeringEnabled 
          ? JSON.stringify(valves) === JSON.stringify(currentNote.fingering)
          : true;
        const isCorrect = nameCorrect && fingeringCorrect;

        setScore(prev => ({
          correct: prev.correct + (isCorrect ? 1 : 0),
          total: prev.total + 1
        }));

        setFeedback({
          isCorrect,
          nameCorrect,
          fingeringCorrect,
          correctName: currentNote.name,
          correctFingering: currentNote.fingering
        });
      };

      const nextNote = () => {
        selectNextNote();
        setNoteName('');
        setAccidental('');
        setValves([0, 0, 0]);
        setFeedback(null);
      };

      const drawStaff = () => {
        const staffY = 120;
        const lineSpacing = 20;
        
        return (
          <svg width="300" height="300" viewBox="0 0 300 300">
            {[0, 1, 2, 3, 4].map(i => (
              <line
                key={i}
                x1="50"
                y1={staffY + i * lineSpacing}
                x2="250"
                y2={staffY + i * lineSpacing}
                stroke="#333"
                strokeWidth="2"
              />
            ))}
            <text x="60" y="210" fontSize="80" fontFamily="serif" fill="#333">ùÑû</text>
            {currentNote && (
              <>
                <ellipse
                  cx="190"
                  cy={staffY + (4 - currentNote.line) * lineSpacing}
                  rx="12"
                  ry="9"
                  fill="white"
                  stroke="#333"
                  strokeWidth="2.5"
                />
                {currentNote.accidental && (
                  <text
                    x="160"
                    y={staffY + (4 - currentNote.line) * lineSpacing + 6}
                    fontSize="24"
                    fontFamily="serif"
                    fontWeight="bold"
                    fill="#333"
                  >
                    {currentNote.accidental === '#' ? '‚ôØ' : '‚ô≠'}
                  </text>
                )}
                {currentNote.line < 0 && (
                  <>
                    {[-1, -2, -3].map(ledgerLine => {
                      if (ledgerLine >= Math.floor(currentNote.line)) {
                        return (
                          <line
                            key={ledgerLine}
                            x1="165"
                            y1={staffY + (4 - ledgerLine) * lineSpacing}
                            x2="215"
                            y2={staffY + (4 - ledgerLine) * lineSpacing}
                            stroke="#333"
                            strokeWidth="2"
                          />
                        );
                      }
                      return null;
                    })}
                  </>
                )}
                {currentNote.line > 4 && (
                  <>
                    {[5, 6, 7, 8].map(ledgerLine => {
                      if (ledgerLine <= Math.ceil(currentNote.line)) {
                        return (
                          <line
                            key={ledgerLine}
                            x1="165"
                            y1={staffY + (4 - ledgerLine) * lineSpacing}
                            x2="215"
                            y2={staffY + (4 - ledgerLine) * lineSpacing}
                            stroke="#333"
                            strokeWidth="2"
                          />
                        );
                      }
                      return null;
                    })}
                  </>
                )}
              </>
            )}
          </svg>
        );
      };

      const minPercentage = (minNoteIndex / (allNotes.length - 1)) * 100;
      const maxPercentage = (maxNoteIndex / (allNotes.length - 1)) * 100;

      return (
        <div className="min-h-screen bg-gray-50 p-8">
          <div className="max-w-2xl mx-auto">
            <div className="text-center mb-8">
              <h1 className="text-4xl font-bold text-gray-800 mb-2">Trumpet Note Quiz</h1>
              <div className="text-xl text-gray-600">
                Score: {score.correct} / {score.total}
                {score.total > 0 && (
                  <span className="ml-2 text-gray-500">
                    ({Math.round((score.correct / score.total) * 100)}%)
                  </span>
                )}
              </div>
            </div>

            <div className="bg-white rounded-2xl shadow-lg p-8 mb-6">
              <div className="mb-6">
                <label className="block text-sm font-medium text-gray-700 mb-3">
                  Note Range
                </label>
                
                {/* Preset Buttons */}
                <div className="grid grid-cols-2 sm:grid-cols-4 gap-2 mb-4">
                  {Object.entries(presets).map(([key, preset]) => (
                    <button
                      key={key}
                      onClick={() => setPreset(preset)}
                      className={`py-2 px-3 rounded-lg text-sm font-medium transition-all ${
                        minNoteIndex === preset.min && maxNoteIndex === preset.max
                          ? 'bg-blue-600 text-white border-2 border-blue-600'
                          : 'bg-white text-gray-700 border-2 border-gray-300 hover:border-blue-400'
                      }`}
                    >
                      {preset.name}
                    </button>
                  ))}
                </div>

                {/* Dual Range Slider */}
                <div className="relative pt-2 pb-8">
                  <div 
                    ref={sliderRef}
                    className="relative h-2 bg-gray-200 rounded-full cursor-pointer"
                    onMouseDown={(e) => {
                      const rect = sliderRef.current.getBoundingClientRect();
                      const x = e.clientX - rect.left;
                      const percentage = x / rect.width;
                      const index = Math.round(percentage * (allNotes.length - 1));
                      
                      const distToMin = Math.abs(index - minNoteIndex);
                      const distToMax = Math.abs(index - maxNoteIndex);
                      
                      if (distToMin < distToMax) {
                        handleSliderMouseDown(e, 'min');
                      } else {
                        handleSliderMouseDown(e, 'max');
                      }
                    }}
                  >
                    {/* Active Range */}
                    <div 
                      className="absolute h-full bg-blue-500 rounded-full"
                      style={{
                        left: `${minPercentage}%`,
                        width: `${maxPercentage - minPercentage}%`
                      }}
                    />
                    
                    {/* Min Handle */}
                    <div
                      className="absolute w-6 h-6 bg-white border-4 border-blue-500 rounded-full cursor-grab active:cursor-grabbing transform -translate-x-1/2 -translate-y-1/2 top-1/2 touch-none"
                      style={{ left: `${minPercentage}%` }}
                      onMouseDown={(e) => handleSliderMouseDown(e, 'min')}
                      onTouchStart={(e) => handleSliderMouseDown(e, 'min')}
                    />
                    
                    {/* Max Handle */}
                    <div
                      className="absolute w-6 h-6 bg-white border-4 border-blue-500 rounded-full cursor-grab active:cursor-grabbing transform -translate-x-1/2 -translate-y-1/2 top-1/2 touch-none"
                      style={{ left: `${maxPercentage}%` }}
                      onMouseDown={(e) => handleSliderMouseDown(e, 'max')}
                      onTouchStart={(e) => handleSliderMouseDown(e, 'max')}
                    />
                  </div>
                  
                  {/* Note Labels */}
                  <div className="flex justify-between mt-2 text-xs text-gray-600">
                    <span className="font-medium">{allNotes[minNoteIndex].displayName}</span>
                    <span className="text-gray-400">to</span>
                    <span className="font-medium">{allNotes[maxNoteIndex].displayName}</span>
                  </div>
                </div>
              </div>

              <div className="mb-6">
                <label className="flex items-center gap-3 cursor-pointer">
                  <input
                    type="checkbox"
                    checked={fingeringEnabled}
                    onChange={(e) => setFingeringEnabled(e.target.checked)}
                    className="w-5 h-5 cursor-pointer"
                  />
                  <span className="text-sm font-medium text-gray-700">
                    Include Valve Fingering
                  </span>
                </label>
              </div>

              <div className="mb-6">
                <label className="flex items-center gap-3 cursor-pointer">
                  <input
                    type="checkbox"
                    checked={includeAccidentals}
                    onChange={(e) => setIncludeAccidentals(e.target.checked)}
                    className="w-5 h-5 cursor-pointer"
                  />
                  <span className="text-sm font-medium text-gray-700">
                    Include Sharps and Flats
                  </span>
                </label>
              </div>

              <div className="flex justify-center mb-6">
                {drawStaff()}
              </div>

              <div className="space-y-6">
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">
                    Note Name
                  </label>
                  <div className="flex gap-2 justify-center mb-3">
                    {['A', 'B', 'C', 'D', 'E', 'F', 'G'].map(letter => (
                      <button
                        key={letter}
                        onClick={() => setNoteName(letter)}
                        disabled={feedback !== null}
                        className={`w-14 h-14 rounded-lg text-xl font-bold transition-all ${
                          noteName === letter
                            ? 'bg-blue-600 text-white border-2 border-blue-600'
                            : 'bg-white text-gray-700 border-2 border-gray-300 hover:border-blue-400'
                        } ${feedback !== null ? 'cursor-not-allowed opacity-50' : 'cursor-pointer'}`}
                      >
                        {letter}
                      </button>
                    ))}
                  </div>
                  <div className="flex gap-3 justify-center">
                    <button
                      onClick={() => setAccidental(accidental === '#' ? '' : '#')}
                      disabled={feedback !== null}
                      className={`px-6 py-3 rounded-lg text-2xl font-bold transition-all ${
                        accidental === '#'
                          ? 'bg-blue-600 text-white border-2 border-blue-600'
                          : 'bg-white text-gray-700 border-2 border-gray-300 hover:border-blue-400'
                      } ${feedback !== null ? 'cursor-not-allowed opacity-50' : 'cursor-pointer'}`}
                    >
                      ‚ôØ
                    </button>
                    <button
                      onClick={() => setAccidental(accidental === 'b' ? '' : 'b')}
                      disabled={feedback !== null}
                      className={`px-6 py-3 rounded-lg text-2xl font-bold transition-all ${
                        accidental === 'b'
                          ? 'bg-blue-600 text-white border-2 border-blue-600'
                          : 'bg-white text-gray-700 border-2 border-gray-300 hover:border-blue-400'
                      } ${feedback !== null ? 'cursor-not-allowed opacity-50' : 'cursor-pointer'}`}
                    >
                      ‚ô≠
                    </button>
                  </div>
                </div>

                {fingeringEnabled && (
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-3">
                      Valve Fingering
                    </label>
                    <div className="flex justify-center gap-8">
                      {[0, 1, 2].map(i => (
                        <button
                          key={i}
                          onClick={() => toggleValve(i)}
                          disabled={feedback !== null}
                          className="flex flex-col items-center gap-2"
                        >
                          <div
                            className={`w-20 h-20 rounded-full border-4 transition-all ${
                              valves[i] === 1
                                ? 'bg-black border-black'
                                : 'bg-white border-gray-400 hover:border-gray-600'
                            } ${feedback !== null ? 'cursor-not-allowed' : 'cursor-pointer'}`}
                          />
                          <span className="text-lg font-semibold text-gray-700">{i + 1}</span>
                        </button>
                      ))}
                    </div>
                  </div>
                )}
              </div>

              {feedback && (
                <div className={`mt-6 p-4 rounded-lg ${feedback.isCorrect ? 'bg-green-100 border-2 border-green-500' : 'bg-red-100 border-2 border-red-500'}`}>
                  <div className="text-lg font-semibold mb-2">
                    {feedback.isCorrect ? '‚úì Correct!' : '‚úó Incorrect'}
                  </div>
                  {!feedback.isCorrect && (
                    <div className="text-sm text-gray-700">
                      {!feedback.nameCorrect && (
                        <div>Note: {feedback.correctName}</div>
                      )}
                      {fingeringEnabled && !feedback.fingeringCorrect && (
                        <div>
                          Fingering: {feedback.correctFingering.map((v, i) => v === 1 ? i + 1 : '').filter(Boolean).join('-') || 'Open (no valves)'}
                        </div>
                      )}
                    </div>
                  )}
                </div>
              )}

              <div className="mt-6 flex gap-4">
                {!feedback ? (
                  <button
                    onClick={checkAnswer}
                    disabled={!noteName}
                    className="flex-1 bg-blue-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors"
                  >
                    Check Answer
                  </button>
                ) : (
                  <button
                    onClick={nextNote}
                    className="flex-1 bg-blue-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-blue-700 transition-colors"
                  >
                    Next Note ‚Üí
                  </button>
                )}
              </div>
            </div>
          </div>
        </div>
      );
    };

    ReactDOM.render(<TrumpetQuiz />, document.getElementById('root'));
  </script>
</body>
</html>
